---
title: "HDT2 Clustering"
author: "Cristopher Barrios, Carlos Daniel Estrada"
date: "16/2/2023"
output:
  html_document:
  code_folding: hide
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(ggplot2)

# Utilizados en el laboratorio
library(hopkins)
library(ggplot2)
library(factoextra) 
library(fpc)
library(cluster)

datos <- read.csv("movies.csv")
```
### 1. Haga el preprocesamiento del dataset, explique qué variables no aportan información a la generación de grupos y por qué. Describa con qué variables calculará los grupos.

- Variables que no aportan: 
* Id: Solo es una variable para identificar cada pelicula
* title: al estar usando el titulo original, no es necesaria esta variable
* homePage: es una variable cualtitiva
* video: es una variables booleana 
* director: no es una variable numérica
* productionCompany: no es una variable numérica
* productionCountry:no es una variable numérica
* actors: no es una variable numérica
* actorsCharacter:no es una variable numérica

- Variables que si aportan: 

Utilizaremos las siguientes variables, ya que consideramos que los calculos que derivan de ellas (media, cuartiles y percentiles) pueden llegar a ser significativas al momento de crear y categorizar los grupos y la cantidad.

* popularity
* Original_Title
* originalLanguage: 
* budget
* revenue
* runtime
* genres
* genresAmount
* productionCoAmount
* productionCountriesAmount
* releaseDate
* voteCount
* voteAvg
* actorsPopularity
* actorsAmount
* castWomenAmount
* castMenAmount

### 2. Analice la tendencia al agrupamiento usando el estadístico de Hopkings y la VAT (Visual Assessment of cluster Tendency). Discuta sus resultados e impresiones. 
```{r}

#numericas <- datos[,c("popularity","budget","revenue","runtime","genreAmount","productionCoAmount")]
#hopkins()
datos<-datos[complete.cases(read.csv("movies.csv")),]

popularity<-datos[,'popularity']
budget<-datos[,'budget']
revenue<-datos[,'revenue']
runtime<-datos[,'runtime']
voteCount<-datos[,'voteCount']

norm<-data.frame(popularity,budget,revenue,runtime,voteCount)
clustering<-scale(norm)
hopkins(clustering)


```
En esto caso el resultado que se obtuvo de la funcion de hopkins esta lejos del o.5 este nos da 0.9 por lo que se puede determinar que los datos que se nos proveen no son aleatorios, entonces el agrupamiento posterior de este sera mas sencillo
```{r}
DistData<- dist(clustering)
```

```{r}
knitr::opts_chunk$set(fig.width=12, fig.height=8) 
fviz_dist(DistData, show_labels = F)
```
Como se puede observar esta un poco rosado por lo que...

### 3. Determine cuál es el número de grupos a formar más adecuado para los datos que está trabajando. 
Haga una gráfica de codo y explique la razón de la elección de la cantidad de clústeres con la que 
trabajará. 
```{r}
wss <- (nrow(clustering)-1)*sum(apply(clustering,2,var))
for (i in 1:10) 
  wss[i] <- sum(kmeans(clustering, centers=i)$withinss)
plot(1:10, wss, type="b", xlab="Cantidad de Clusters",  ylab="Cantidad de suma de cuadrados")
```
Como podemos observar en la grafica de codo el numero de clusters que mejor se acomoda es el de 6
```{r}
NClusters <- 6
```


### 4. Utilice  los  algoritmos  k-medias  y  clustering  jerárquico  para  agrupar.  Compare  los  resultados generados por cada uno. 

K-means
```{r}

```

Cluster Jerarquico
```{r}

```

### 5. Determine la calidad del agrupamiento hecho por cada algoritmo con el método de la silueta. Discuta los resultados. 

K-means
```{r}
km<-kmeans(clustering,NClusters,iter.max =100)
datos$grupo<-km$cluster
plotcluster(clustering,km$cluster) 

#silueta
fviz_cluster(km, data = clustering,geom = "point", ellipse.type = "norm")
SiluetaK<-silhouette(km$cluster,dist(clustering))
mean(SiluetaK[,3]) 
Kmean<-mean(SiluetaK[,3])
plot(SiluetaK, cex.names=.4, col=1:3, border=NA)
```

Cluster Jerarquico
```{r}
Matrix<- dist(clustering)
hc<-hclust(DistData, method = "ward.D2") 
plot(hc, cex=0.5, axes=FALSE)

# silueta
rect.hclust(hc,k=3)
groups<-cutree(hc,k=3) 
datos$gruposHC<-groups
silhc<-silhouette(groups,DistData)
mean(silhc[,3]) 
Jerarquico<-mean(silhc[,3])
plot(silhc, cex.names=.4, col=1:3, border = NA)

```
Se puede ver en la grafica con la silueta que los clusters utilizados se alinean en la mayoria solo unos pocos son atipicos

### 6. Interprete  los  grupos  basado  en  el  conocimiento  que  tiene  de  los  datos.  Recuerde  investigar  las 
medidas de tendencia central de las variables continuas y las tablas de frecuencia de las variables categóricas pertenecientes a cada grupo. Identifique hallazgos interesantes debido a las agrupaciones y describa para qué le podría servir. 